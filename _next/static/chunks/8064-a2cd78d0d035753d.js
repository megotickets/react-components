"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8064],{8064:function(e,t,o){o.d(t,{HO:function(){return G},Qg:function(){return x},gr:function(){return f}});var a=o(5173),l=o(3813),s=o(2093),r=o(6553),n=o(5861),i=o(5611);o(7756);var c=o(8732),g=o(3338),d=o(511),m=o(9075),u=o(4798),h=o(1723),p=o(9832),w=o(1501),v=(0,n._)({chains:[l.R,s.y],transports:{[l.R.id]:(0,r.d)(),[s.y.id]:(0,r.d)()}});function x(e){let{children:t}=e,[o]=(0,d.useState)(()=>new c.S({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:0,staleTime:3e4}}}));return(0,m.jsx)(g.aH,{client:o,children:(0,m.jsx)(i.F,{config:v,children:(0,m.jsx)(a.pj,{children:t})})})}var C=(0,d.createContext)(void 0),j="https://wallet.mego.tools",y=()=>{let e=(0,d.useContext)(C);if(void 0===e)throw Error("useWeb3Context deve essere usato all'interno di un Web3Provider");return e},f=e=>{let{children:t}=e,{openConnectModal:o}=(0,a.We)(),[l,s]=(0,d.useState)("ChooseType"),[r,n]=(0,d.useState)(),[i,c]=(0,d.useState)(!1),[g,v]=(0,d.useState)(null),[x,y]=(0,d.useState)(null),[f,N]=(0,d.useState)(null),[E,S]=(0,d.useState)(null),[b,P]=(0,d.useState)(!1),[L,k]=(0,d.useState)(""),[A,T]=(0,d.useState)(null),I=()=>{c(!0),P(!1)};(0,d.useEffect)(()=>{try{if(E&&"walletConnect"!==g){console.log("Rilevato accesso tramite un provider != walletConnect");let e=new u.r6(w.env.REACT_APP_JSON_RPC_PROVIDER);N(e)}}catch(e){console.error("Error during loggedAs check",e),console.log(e)}},[E]);let R=()=>{localStorage.setItem("isQuestionary","false"),c(!1),P(!1)};(0,d.useEffect)(()=>{"true"===localStorage.getItem("isQuestionary")&&I()},[]);let O=async()=>{try{window.ethereum.removeAllListeners(),y(null),v(null),S(null),localStorage.removeItem("provider"),localStorage.removeItem("loggedAs")}catch(e){console.error("Error logging out of walletconnect:",e)}};function G(){v(null),S(null),O(),localStorage.removeItem("provider"),localStorage.removeItem("loggedAs"),console.log("[DEBUG]Effettuando il logout, loggedAs in localStorage:",localStorage.getItem("loggedAs")),window.history.replaceState(null,"",window.location.pathname)}(0,d.useEffect)(()=>{console.log("[DEBUG]loggedAs ripristinato:",E),console.log("[DEBUG]provider ripristinato:",g)},[E,g]);let D=()=>"walletConnect"===g?x:f,W=async()=>"walletConnect"===g&&x?await x.getSigner():{getAddress:async()=>E,signMessage:async e=>{throw Error("Signing not supported for this provider")},sendTransaction:async e=>D().sendTransaction(e),connect:e=>e},K=async()=>{if(k("Checking walletconnect ..."),!window.ethereum){alert("walletConnect is not installed");return}try{let e=new h.Q(window.ethereum);await e.send("eth_requestAccounts",[]);let t=await e.getSigner(),o=await t.getAddress();v("walletConnect"),y(e),S(o),localStorage.setItem("loggedAs",o),localStorage.setItem("provider","walletConnect"),s("Logged"),w.env.REACT_APP_CHAIN_ID&&await e.send("wallet_switchEthereumChain",[{chainId:"0x".concat(parseInt(w.env.REACT_APP_CHAIN_ID).toString(16))}])}catch(e){console.error("Error initializing provider:",e),console.log(e)}finally{P(!1),k("")}},F=async(e,t)=>{let o=e.toLowerCase();k("Checking email and password");let a=await p.Z.post("".concat(j,"/wallets/check"),{email:o,password:t});!1===a.data.error?(P(!1),k(""),S(a.data.addresses.eth),localStorage.setItem("loggedAs",a.data.addresses.eth),localStorage.setItem("provider","email"),localStorage.setItem("email",e),v("email")):(k(""),alert(a.data.message),P(!1))};async function U(e,t){if(!b){P(!0),k("Creating new mego wallet");let o=e.toLowerCase(),a=await p.Z.post("".concat(j,"/wallets/email/new"),{email:o,password:t});a.data.error?(alert(a.data.message),P(!1),k("")):await F(e,t)}}(0,d.useEffect)(()=>{console.log("[DEBUG] Executing useEffect");let e=new URLSearchParams(window.location.search),t=e.get("provider"),o=e.get("loggedAs")||e.get("signedAs"),a=e.get("exported");if(t&&(console.log("[DEBUG] #1 - urlProvider:",t),v(t),localStorage.setItem("provider",t),"google"===t&&N(new u.r6(w.env.REACT_APP_JSON_RPC_PROVIDER)),a&&I()),o&&(console.log("[DEBUG] #2 - urlLoggedAs:",o),S(o),localStorage.setItem("loggedAs",o)),!t&&!o){console.log("[DEBUG] #3 - !urlProvider && !urlLoggedAs");let e=localStorage.getItem("provider"),t=localStorage.getItem("loggedAs");e&&(v(e),"google"===e?N(new u.r6(w.env.REACT_APP_JSON_RPC_PROVIDER)):"walletConnect"===e&&K()),t&&S(t)}if("google"===t&&o){console.log("[DEBUG] #4 - urlProvider === 'google' && urlLoggedAs");try{let e=new u.r6("https://base-sepolia.g.alchemy.com/v2/KxxtZXKplWuSt71LXxy-9Mr4BhucrqEP");N(e),v("google"),S(o),localStorage.setItem("provider","google"),localStorage.setItem("loggedAs",o)}catch(e){console.error("[Google Auth] Error initializing provider:",e)}}},[]),(0,d.useEffect)(()=>{var e;let t=async e=>{console.log("Chain cambiata:",e);let t="0x".concat(Number(w.env.REACT_APP_CHAIN_ID).toString(16));if(e!==t)try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:t}]})}catch(e){console.error("Errore nel cambio rete:",e)}};return null==(e=window.ethereum)||e.on("chainChanged",t),()=>{var e;null==(e=window.ethereum)||e.removeListener("chainChanged",t)}},[]),(0,d.useEffect)(()=>{var e;let t=async e=>{if(e.length>0){let e=new h.Q(window.ethereum),t=await e.getSigner(),o=await t.getAddress();S(o),localStorage.setItem("loggedAs",o),s("Logged")}else G()};return null==(e=window.ethereum)||e.on("accountsChanged",t),()=>{var e;null==(e=window.ethereum)||e.removeListener("accountsChanged",t)}},[]);let B=async()=>{P(!0),s("TokenForPrivateKey")},M=async()=>{P(!0),setTimeout(()=>{window.location.href=j+"/auth/google?origin="+window.location.href.replace("https://","").replace("http://","")+"&message=EXPORT_WALLET"},2500)},q=async()=>{P(!0),s("TokenForPrivateKey")},H=async e=>{P(!0),k("Revealing private key..."),console.log("Revealing private key with token:",e);let t=await p.Z.post("".concat(j,"/wallets/export"),{token:e});t.data.error?(k(t.data.message),alert(t.data.message),P(!1),k(""),setTimeout(()=>{window.location.href=window.location.origin},1e3)):(P(!1),T(t.data.private_keys.eth),s("PrivateKey"))};return(0,m.jsxs)(C.Provider,{value:{getProvider:D,getSigner:W,isMegoModalOpen:i,openMegoModal:I,redirectToAppleLogin:function(){P(!0),localStorage.setItem("justLogged","true"),setTimeout(()=>{window.location.href=j+"/auth/apple?origin="+window.location.href.replace("https://","").replace("http://","")},2500)},redirectToGoogleLogin:function(){P(!0),localStorage.setItem("justLogged","true"),setTimeout(()=>{window.location.href=j+"/auth/google?origin="+window.location.href.replace("https://","").replace("http://","")},2500),console.log("redirectToGoogleLogin - ECCOCI QUI")},closeMegoModal:R,provider:g,walletConnectProvider:x,loginWithWalletConnect:K,section:l,setSection:s,prevSection:r,setPrevSection:n,loggedAs:E,isLoading:b,logout:G,setIsLoading:P,loadingText:L,setLoadingText:k,loginWithEmail:F,createNewWallet:U,requestExportPrivateKeyWithEmail:B,requestExportPrivateKeyWithGoogle:M,requestExportPrivateKeyWithApple:q,revealPrivateKey:H,privateKey:A},children:[t,i&&(0,m.jsx)(_,{isOpen:i,onClose:R})]})},N=e=>{let{account:t,chain:o,authenticationStatus:a,mounted:l,openConnectModal:s,openAccountModal:r,loginWithWalletConnect:n,loggedAs:i}=e;return l&&"loading"!==a?t&&o?i?(0,m.jsxs)("button",{className:"mego-modal-button",onClick:r,children:[(0,m.jsx)("img",{width:17,src:"/walletconnect.svg",alt:"WalletConnect",className:"mr-2 mt-1"}),t.displayName]}):(0,m.jsxs)("button",{className:"mego-modal-button",onClick:()=>n(t.address),children:[(0,m.jsx)("img",{width:17,src:"/walletconnect.svg",alt:"WalletConnect",className:"mr-2 mt-1"}),"WALLET CONNECT"]}):(0,m.jsxs)("button",{className:"mego-modal-button",onClick:s,children:[(0,m.jsx)("img",{width:17,src:"/walletconnect.svg",alt:"WalletConnect",className:"mr-2 mt-1"}),"WALLET CONNECT"]}):(0,m.jsx)("button",{className:"mego-modal-button",children:"Caricamento..."})},E=function(){let{loginWithWalletConnect:e,loggedAs:t}=y();return(0,m.jsx)(a.NL.Custom,{children:o=>{let{account:a,chain:l,openConnectModal:s,openAccountModal:r,authenticationStatus:n,mounted:i}=o;return(0,m.jsx)(N,{account:a,chain:l,authenticationStatus:null!=n?n:"",mounted:i,openConnectModal:s,openAccountModal:r,loginWithWalletConnect:e,loggedAs:null!=t?t:void 0})}})},S=e=>{let{setSection:t}=e,{redirectToAppleLogin:o,redirectToGoogleLogin:a}=y();return(0,m.jsxs)("div",{children:[(0,m.jsxs)("button",{className:"mego-modal-button mego-apple",onClick:o,children:[(0,m.jsx)("img",{src:"/apple.svg",alt:"Apple",className:"mr-2"}),"APPLE ACCOUNT"]}),(0,m.jsxs)("button",{className:"mego-modal-button",onClick:a,children:[(0,m.jsx)("img",{width:17,src:"/google.svg",alt:"Google",className:"mr-2 mt-1"}),"GOOGLE ACCOUNT"]}),(0,m.jsx)(E,{}),(0,m.jsxs)("button",{className:"mego-modal-button mego-email",onClick:()=>t("Email"),children:[(0,m.jsx)("img",{src:"/email.svg",width:30,alt:"Email",className:"mr-2"}),"E-MAIL"]})]})},b=e=>{let{setSection:t}=e;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("button",{className:"mego-modal-button outlined",onClick:()=>t("Login"),children:"LOGIN"}),(0,m.jsx)("button",{className:"mego-modal-button outlined",onClick:()=>t("Register"),children:"SIGN UP"})]})},P=e=>{let{logout:t}=e,{loggedAs:o,setSection:a,provider:l,requestExportPrivateKeyWithGoogle:s,requestExportPrivateKeyWithApple:r,openMegoModal:n}=y();return new URLSearchParams(window.location.search).get("exported")&&a("TokenForPrivateKey"),(0,m.jsxs)("div",{children:[(0,m.jsxs)("button",{className:"mego-modal-button outlined",onClick:()=>{o&&(navigator.clipboard.writeText(o),alert("Address copied to clipboard"))},children:[(0,m.jsx)("img",{src:"/copy.svg",alt:"TurnOff",style:{marginRight:"0.5rem",height:"1.5rem",width:"1.5rem"}}),"Copy address"]}),"walletConnect"!==l&&(0,m.jsxs)("button",{className:"mego-modal-button outlined",onClick:()=>{switch(console.log("provider -> ",l),l){case"email":a("LoginWithPasswordForPrivateKey");break;case"google":case"google?provider=google":s();break;case"apple":case"apple?provider=apple":r()}},children:[(0,m.jsx)("img",{src:"/export_key.svg",alt:"TurnOff",style:{marginRight:"0.5rem",height:"1.5rem",width:"1.5rem"}}),"Export private key"]}),(0,m.jsxs)("button",{className:"mego-modal-button outlined",onClick:t,children:[(0,m.jsx)("img",{src:"/disconnect.svg",alt:"TurnOff",style:{marginRight:"0.5rem",height:"1.5rem",width:"1.5rem"}}),"Disconnect"]})]})},L=()=>(0,m.jsx)("div",{children:(0,m.jsx)("h5",{className:"mego-login-text",children:"Export private key to implement"})}),k=()=>{let[e,t]=(0,d.useState)("");return(0,m.jsxs)("div",{children:[(0,m.jsx)("h5",{className:"mego-login-text",children:"Insert password to obtain private key"}),(0,m.jsx)("input",{className:"mego-input",id:"password",placeholder:"Password...",value:e,onChange:e=>t(e.target.value)})]})},A=()=>{let[e,t]=(0,d.useState)(""),{revealPrivateKey:o}=y();return(0,m.jsxs)("div",{className:"w-full flex flex-col items-center justify-center",children:[(0,m.jsx)("input",{className:"mego-input-token",id:"token",placeholder:"Insert token...",value:e,onChange:e=>t(e.target.value)}),(0,m.jsx)("button",{disabled:0==e.length,className:"mego-modal-button mt-3 "+(0==e.length?"opacity-50":""),onClick:()=>o(e),children:"Reveal private key"})]})},T=()=>{let{privateKey:e}=y();return(0,m.jsxs)("div",{children:[(0,m.jsxs)("h5",{className:"mego-login-text",children:["Private key: ",e]}),(0,m.jsx)("button",{className:"mego-modal-button outlined",onClick:()=>{e&&(navigator.clipboard.writeText(e),alert("Private key copied to clipboard"))},children:"Copy private key"})]})},I=()=>{let{createNewWallet:e,loginWithEmail:t}=y(),[o,a]=(0,d.useState)(""),[l,s]=(0,d.useState)("");return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("h5",{className:"mego-login-text",children:"Type your e-mail address and Password to login"}),(0,m.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t(o,l)},className:"mego-form",children:[(0,m.jsx)("input",{className:"mego-input",id:"email",placeholder:"E-mail address...",value:o,onChange:e=>a(e.target.value),type:"email",name:"email",required:!0,title:"Insert a valid email"}),(0,m.jsx)("input",{className:"mego-input",id:"password",placeholder:"Password...",type:"password",name:"password",value:l,onChange:e=>s(e.target.value),required:!0,pattern:"(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{8,}",title:"Password must contain at least 8 characters, including one uppercase letter, one lowercase letter, and one number"}),(0,m.jsx)("button",{className:"mego-modal-button mt-3",type:"submit",style:{maxWidth:200},children:"LOGIN"})]})]})},R=()=>{let{createNewWallet:e}=y(),[t,o]=(0,d.useState)(""),[a,l]=(0,d.useState)("");return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("h5",{className:"mego-login-text",children:"Type your e-mail address and Password to register"}),(0,m.jsxs)("form",{onSubmit:o=>{o.preventDefault(),e(t,a)},className:"mego-form",children:[(0,m.jsx)("input",{className:"mego-input",id:"email",placeholder:"E-mail address...",value:t,onChange:e=>o(e.target.value),type:"email",name:"email",required:!0,title:"Insert a valid email"}),(0,m.jsx)("input",{className:"mego-input",id:"password",placeholder:"Password...",type:"password",name:"password",value:a,onChange:e=>l(e.target.value),required:!0,pattern:"(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{8,}",title:"Password must contain at least 8 characters, including one uppercase letter, one lowercase letter, and one number"}),(0,m.jsx)("p",{className:"mego-login-text ",style:{marginTop:-10,marginBottom:0,fontSize:11},children:"Password must contain at least 8 characters, including one uppercase letter, one lowercase letter, and one number"}),(0,m.jsx)("button",{className:"mego-modal-button mt-3",type:"submit",style:{maxWidth:200},children:"REGISTER"})]})]})},_=function(e){let{isOpen:t,onClose:o}=e,[a,l]=(0,d.useState)(!1),{isLoading:s,loggedAs:r,logout:n,loadingText:i,section:c,setSection:g,prevSection:u,setPrevSection:h}=y();function p(e){g(e),"ChooseType"===e&&h(void 0),"Email"===e&&h("ChooseType"),"Login"===e&&h("Email"),"Register"===e&&h("Email"),"Logged"===e&&h(void 0),"ExportPrivateKey"===e&&h("Logged"),"TokenForPrivateKey"===e&&h("ExportPrivateKey"),"LoginWithPasswordForPrivateKey"===e&&h("Logged")}function w(){l(!0),setTimeout(()=>{o(),l(!1)},300)}return((0,d.useEffect)(()=>{t&&(r?g("Logged"):p("ChooseType"),l(!1))},[t,r]),(0,d.useEffect)(()=>{r&&t&&setTimeout(()=>{g("Logged")},100)},[r,t]),t||a)?(0,m.jsxs)("div",{className:"".concat(a?"closing":""," mego-modal-container"),children:[(0,m.jsx)("div",{className:"mego-modal-backdrop",onClick:w}),(0,m.jsxs)("div",{className:"mego-modal-wrapper",style:{backgroundColor:"white"},children:[(0,m.jsxs)("div",{className:"mego-modal-header",children:[(0,m.jsxs)("div",{className:"mego-modal-logo",children:[(0,m.jsx)("img",{height:22,src:"/mego.svg",alt:"MegoLogo",style:{marginRight:"0.5rem",marginTop:"0.5rem"}}),(0,m.jsx)("img",{height:13,src:"/megoLetter.svg",alt:"MegoLetter",style:{marginRight:"0.5rem",marginTop:"0.5rem"}})]}),(0,m.jsxs)("div",{className:"mego-modal-buttons",children:[u&&!r&&(0,m.jsx)("img",{role:"button",height:16,onClick:()=>p(u),src:"/arrowBack.svg",alt:"BackIcon",style:{marginRight:"0.5rem",marginTop:"0.5rem"}}),(0,m.jsx)("img",{role:"button",height:16,onClick:w,src:"/cross.svg",alt:"CloseIcon",style:{marginRight:"0.5rem",marginTop:"0.5rem"}})]})]}),(0,m.jsx)("div",{className:"mego-modal-content",children:(0,m.jsxs)("span",{style:{transform:"scale(0.8)",height:300,transition:"height 0.3s"},children:[(0,m.jsx)("div",{className:"mego-modal-title",children:"Register"===c?"REGISTER":"LOGIN"}),(0,m.jsx)(m.Fragment,{children:"\xa0"}),s?(0,m.jsxs)("div",{className:"mego-loader-div",children:[(0,m.jsx)("div",{className:"loader"}),(0,m.jsx)("p",{className:"mego-login-text",style:{marginTop:"0.5rem"},children:i||"Loading data..."})]}):function(){switch(c){case"ChooseType":return(0,m.jsx)(S,{setSection:p});case"Email":return(0,m.jsx)(b,{setSection:p});case"Login":return(0,m.jsx)(I,{});case"Logged":return(0,m.jsx)(P,{logout:n});case"Register":return(0,m.jsx)(R,{});case"ExportPrivateKey":return(0,m.jsx)(L,{});case"TokenForPrivateKey":return(0,m.jsx)(A,{});case"LoginWithPasswordForPrivateKey":return(0,m.jsx)(k,{});case"PrivateKey":return(0,m.jsx)(T,{})}}()]})})]})]}):null},O=()=>(0,m.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,m.jsx)("path",{d:"M3.00001 6.5V6.5C3.00001 5.11929 4.1193 4 5.50001 4L19.2857 4C19.4852 4 19.585 4 19.6651 4.02806C19.8088 4.07831 19.9217 4.19124 19.9719 4.33486C20 4.41505 20 4.51479 20 4.71429V4.71429C20 5.91124 20 6.50972 19.8317 6.99084C19.5301 7.85258 18.8526 8.53011 17.9908 8.83165C17.5097 9 16.9112 9 15.7143 9L15 9M3.00001 6.5V6.5C3.00001 7.88071 4.11929 9 5.50001 9L19 9C19.9428 9 20.4142 9 20.7071 9.29289C21 9.58579 21 10.0572 21 11L21 13M3.00001 6.5L3.00001 17C3.00001 18.8856 3.00001 19.8284 3.58579 20.4142C4.17158 21 5.11439 21 7.00001 21L19 21C19.9428 21 20.4142 21 20.7071 20.7071C21 20.4142 21 19.9428 21 19L21 17M21 17H17C16.0572 17 15.5858 17 15.2929 16.7071C15 16.4142 15 15.9428 15 15V15C15 14.0572 15 13.5858 15.2929 13.2929C15.5858 13 16.0572 13 17 13H21M21 17L21 13",stroke:"white","stroke-width":"2"})});function G(){let{openMegoModal:e,loggedAs:t,provider:o}=y();return(0,m.jsxs)("div",{className:"mego-wallet-icon",role:"button",onClick:e,children:[(0,m.jsx)(O,{}),t&&(0,m.jsxs)("div",{children:[t.slice(0,6),"..."]})]})}}}]);